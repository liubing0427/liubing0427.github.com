
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta name="baidu_union_verify" content="dafe71a3b0ba246dbd433cb490d3310d"/>
    <meta name="google-site-verification" content="mw1KOVgTAORcoHehGDB5jnRa3xBuNuwCTXVqSvxyqBI"/>
    <meta name="msvalidate.01" content="4DC3638736C584D35FE2CB969B115974"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>
    <link rel="shortcut icon" href="/images/favicon.ico"/>
    <title>使用VBA将多个excel文档合并成一个excel</title>
</head>
<body>

<meta name="description" content="使用VBA将多个excel文档按row和column两种方式合并成一个excel"/>

<meta name="author" content="Liu Bing"/>
<!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
<!--[if lt IE 9]>
<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
<![endif]-->
<!-- Le styles -->
<link href="//cdn.bootcss.com/bootstrap/3.3.4/css/bootstrap.min.css" rel="stylesheet"/>
<link href="/assets/themes/twitter/css/style.css?body=1" rel="stylesheet" type="text/css" media="all"/>
<link href="http://7d9pos.com1.z0.glb.clouddn.com/css/pygments.css?body=1" rel="stylesheet" type="text/css" media="all"/>
<link href="http://7d9pos.com1.z0.glb.clouddn.com/Font-Awesome/css/font-awesome.min.css" rel="stylesheet"/>
<!-- Le fav and touch icons -->
<!-- Update these with your own images
  <link rel="shortcut icon" href="images/favicon.ico">
  <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
  <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
-->

<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
                    data-target="#navbar-collapse" aria-expanded="false">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">
                <b class="brand__forename">Bing's</b>
                <b class="brand__surname">Blog</b>
            </a>
        </div>
        <div class="navbar-collapse collapse" id="navbar-collapse" aria-expanded="false" style="height: 1px;">
            <ul class="nav navbar-nav">
                <li><a href="/archive"><i class="icon-large icon-th-list"></i><b class="title_name"> Archive</b></a>
                </li>
                <!--<li><a href="/categories"><i class="icon-large icon-folder-open"></i><b class="title_name">
                    Categories</b></a></li>
                <li><a href="/tags"><i class="icon-large icon-tags"></i><b class="title_name"> Tags</b></a></li>-->
                <li><a href="/app"><i class="icon-large icon-th-large"></i><b class="title_name"> App</b></a></li>
                <li><a href="/about"><i class="icon-large icon-user"></i><b class="title_name"> About Me</b></a>
                </li>
                <li><a href="/messageboard"><i class="icon-large icon-comment"></i><b class="title_name"> Message Board</b></a></li>
                <li><a class="rss_feed" href="/atom.xml"><i class="icon-large icon-rss"></i><b class="title_name"> Rss</b></a></li>
            </ul>
        </div>
    </div>
</nav>
<div class="container">
    <div class="row">
        
<div class="page-header">
    <h1>
        [<a href="/categories#Excel-ref">Excel</a>] 使用VBA将多个excel文档合并成一个excel
        <small>-- 26 March 2017 </small>
    </h1>
</div>

<div class="col-md-8 main-content">
    <div class="post page">
        
<p><strong>在网上搜索多个excel文档合并成一个excel文档的方法， 发现找到的都是按照row来合并的，如下：</strong></p>

<figure class="highlight"><pre><code class="language-vbnet" data-lang="vbnet"><span></span><span class="k">Sub</span> <span class="err">合并当前目录下所有工作簿的全部工作表()</span>
<span class="k">Dim</span> <span class="n">MyPath</span><span class="p">,</span> <span class="n">MyName</span><span class="p">,</span> <span class="n">AWbName</span>
<span class="k">Dim</span> <span class="n">Wb</span> <span class="ow">As</span> <span class="n">Workbook</span><span class="p">,</span> <span class="n">WbN</span> <span class="ow">As</span> <span class="kt">String</span>
<span class="k">Dim</span> <span class="n">Num</span> <span class="ow">As</span> <span class="kt">Long</span>
<span class="k">Dim</span> <span class="n">BOX</span> <span class="ow">As</span> <span class="kt">String</span>
<span class="n">Application</span><span class="p">.</span><span class="n">ScreenUpdating</span> <span class="o">=</span> <span class="k">False</span>
<span class="n">MyPath</span> <span class="o">=</span> <span class="n">ActiveWorkbook</span><span class="p">.</span><span class="n">Path</span>
<span class="n">MyName</span> <span class="o">=</span> <span class="n">Dir</span><span class="p">(</span><span class="n">MyPath</span> <span class="o">&amp;</span> <span class="s">&quot;\&quot;</span> <span class="o">&amp;</span> <span class="s">&quot;*.xls&quot;</span><span class="p">)</span>
<span class="n">AWbName</span> <span class="o">=</span> <span class="n">ActiveWorkbook</span><span class="p">.</span><span class="n">Name</span>
<span class="n">Num</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">Do</span> <span class="k">While</span> <span class="n">MyName</span> <span class="o">&lt;&gt;</span> <span class="s">&quot;&quot;</span>
<span class="k">If</span> <span class="n">MyName</span> <span class="o">&lt;&gt;</span> <span class="n">AWbName</span> <span class="k">Then</span>
<span class="k">Set</span> <span class="n">Wb</span> <span class="o">=</span> <span class="n">Workbooks</span><span class="p">.</span><span class="n">Open</span><span class="p">(</span><span class="n">MyPath</span> <span class="o">&amp;</span> <span class="s">&quot;\&quot;</span> <span class="o">&amp;</span> <span class="n">MyName</span><span class="p">)</span>
<span class="n">Num</span> <span class="o">=</span> <span class="n">Num</span> <span class="o">+</span> <span class="mi">1</span>
<span class="k">With</span> <span class="n">Workbooks</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">ActiveSheet</span>
<span class="k">If</span> <span class="n">Num</span> <span class="o">&lt;&gt;</span> <span class="mi">1</span> <span class="k">Then</span>
<span class="n">Wb</span><span class="p">.</span><span class="n">Sheets</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">UsedRange</span><span class="p">.</span><span class="n">Offset</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">).</span><span class="n">Copy</span> <span class="p">.</span><span class="n">Cells</span><span class="p">(.</span><span class="n">Range</span><span class="p">(</span><span class="s">&quot;A65536&quot;</span><span class="p">).</span><span class="n">End</span><span class="p">(</span><span class="n">xlUp</span><span class="p">).</span><span class="n">Row</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="k">Else</span>
<span class="n">Wb</span><span class="p">.</span><span class="n">Sheets</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">UsedRange</span><span class="p">.</span><span class="n">Copy</span> <span class="p">.</span><span class="n">Cells</span><span class="p">(.</span><span class="n">Range</span><span class="p">(</span><span class="s">&quot;A65536&quot;</span><span class="p">).</span><span class="n">End</span><span class="p">(</span><span class="n">xlUp</span><span class="p">).</span><span class="n">Row</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="k">End</span> <span class="k">If</span>
<span class="n">WbN</span> <span class="o">=</span> <span class="n">WbN</span> <span class="o">&amp;</span> <span class="n">Chr</span><span class="p">(</span><span class="mi">13</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">Wb</span><span class="p">.</span><span class="n">Name</span>
<span class="n">Wb</span><span class="p">.</span><span class="n">Close</span> <span class="k">False</span>
<span class="k">End</span> <span class="k">With</span>
<span class="k">End</span> <span class="k">If</span>
<span class="n">MyName</span> <span class="o">=</span> <span class="n">Dir</span>
<span class="k">Loop</span>
<span class="n">Range</span><span class="p">(</span><span class="s">&quot;A1&quot;</span><span class="p">).</span><span class="n">Select</span>
<span class="n">Application</span><span class="p">.</span><span class="n">ScreenUpdating</span> <span class="o">=</span> <span class="k">True</span>
<span class="n">MsgBox</span> <span class="s">&quot;共合并了&quot;</span> <span class="o">&amp;</span> <span class="n">Num</span> <span class="o">&amp;</span> <span class="s">&quot;个工作薄下的全部工作表。如下：&quot;</span> <span class="o">&amp;</span> <span class="n">Chr</span><span class="p">(</span><span class="mi">13</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">WbN</span><span class="p">,</span> <span class="n">vbInformation</span><span class="p">,</span> <span class="s">&quot;提示&quot;</span>
<span class="k">End</span> <span class="k">Sub</span></code></pre></figure>

<p><strong>效果：</strong></p>

<p><img class="img-responsive center-block" alt="datasync" src="/assets/image/posts/excel1_0.png" width="594" height="405" /></p>
<p><img class="img-responsive center-block" alt="datasync" src="/assets/image/posts/excel1_1.png" width="594" height="405" /></p>
<p><img class="img-responsive center-block" alt="datasync" src="/assets/image/posts/excel1_2.png" width="594" height="405" /></p>

<p><strong>所以修改了一下，可以实现按column合并：</strong></p>

<figure class="highlight"><pre><code class="language-vbnet" data-lang="vbnet"><span></span><span class="k">Sub</span> <span class="err">合并当前目录下所有工作簿的全部工作表()</span>
<span class="k">Dim</span> <span class="n">MyPath</span><span class="p">,</span> <span class="n">MyName</span><span class="p">,</span> <span class="n">AWbName</span>
<span class="k">Dim</span> <span class="n">Wb</span> <span class="ow">As</span> <span class="n">Workbook</span><span class="p">,</span> <span class="n">WbN</span> <span class="ow">As</span> <span class="kt">String</span>
<span class="k">Dim</span> <span class="n">Num</span> <span class="ow">As</span> <span class="kt">Long</span>
<span class="k">Dim</span> <span class="n">BOX</span> <span class="ow">As</span> <span class="kt">String</span>
<span class="k">Dim</span> <span class="n">lColumn</span> <span class="ow">As</span> <span class="kt">Long</span>
<span class="n">Application</span><span class="p">.</span><span class="n">ScreenUpdating</span> <span class="o">=</span> <span class="k">False</span>
<span class="n">MyPath</span> <span class="o">=</span> <span class="n">ActiveWorkbook</span><span class="p">.</span><span class="n">Path</span>
<span class="n">MyName</span> <span class="o">=</span> <span class="n">Dir</span><span class="p">(</span><span class="n">MyPath</span> <span class="o">&amp;</span> <span class="s">&quot;\&quot;</span> <span class="o">&amp;</span> <span class="s">&quot;*.xls&quot;</span><span class="p">)</span>
<span class="n">AWbName</span> <span class="o">=</span> <span class="n">ActiveWorkbook</span><span class="p">.</span><span class="n">Name</span>
<span class="n">Num</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">Do</span> <span class="k">While</span> <span class="n">MyName</span> <span class="o">&lt;&gt;</span> <span class="s">&quot;&quot;</span>
<span class="k">If</span> <span class="n">MyName</span> <span class="o">&lt;&gt;</span> <span class="n">AWbName</span> <span class="k">Then</span>
<span class="k">Set</span> <span class="n">Wb</span> <span class="o">=</span> <span class="n">Workbooks</span><span class="p">.</span><span class="n">Open</span><span class="p">(</span><span class="n">MyPath</span> <span class="o">&amp;</span> <span class="s">&quot;\&quot;</span> <span class="o">&amp;</span> <span class="n">MyName</span><span class="p">)</span>
<span class="n">Num</span> <span class="o">=</span> <span class="n">Num</span> <span class="o">+</span> <span class="mi">1</span>
<span class="k">With</span> <span class="n">Workbooks</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">ActiveSheet</span>
<span class="n">lColumn</span> <span class="o">=</span> <span class="p">.</span><span class="n">Cells</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">Columns</span><span class="p">.</span><span class="n">Count</span><span class="p">).</span><span class="n">End</span><span class="p">(</span><span class="n">xlToLeft</span><span class="p">).</span><span class="n">Column</span>
<span class="k">If</span> <span class="n">Num</span> <span class="o">&lt;&gt;</span> <span class="mi">1</span> <span class="k">Then</span>
<span class="n">Wb</span><span class="p">.</span><span class="n">Sheets</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">UsedRange</span><span class="p">.</span><span class="n">Offset</span><span class="p">(,</span> <span class="mi">1</span><span class="p">).</span><span class="n">Copy</span> <span class="p">.</span><span class="n">Cells</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">lColumn</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<span class="k">Else</span>
<span class="n">Wb</span><span class="p">.</span><span class="n">Sheets</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">UsedRange</span><span class="p">.</span><span class="n">Copy</span> <span class="p">.</span><span class="n">Cells</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">lColumn</span><span class="p">)</span>
<span class="k">End</span> <span class="k">If</span>
<span class="n">WbN</span> <span class="o">=</span> <span class="n">WbN</span> <span class="o">&amp;</span> <span class="n">Chr</span><span class="p">(</span><span class="mi">13</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">Wb</span><span class="p">.</span><span class="n">Name</span>
<span class="n">Wb</span><span class="p">.</span><span class="n">Close</span> <span class="k">False</span>
<span class="k">End</span> <span class="k">With</span>
<span class="k">End</span> <span class="k">If</span>
<span class="n">MyName</span> <span class="o">=</span> <span class="n">Dir</span>
<span class="k">Loop</span>
<span class="n">Range</span><span class="p">(</span><span class="s">&quot;B1&quot;</span><span class="p">).</span><span class="n">Select</span>
<span class="n">Application</span><span class="p">.</span><span class="n">ScreenUpdating</span> <span class="o">=</span> <span class="k">True</span>
<span class="n">MsgBox</span> <span class="s">&quot;共合并了&quot;</span> <span class="o">&amp;</span> <span class="n">Num</span> <span class="o">&amp;</span> <span class="s">&quot;个工作薄下的全部工作表。如下：&quot;</span> <span class="o">&amp;</span> <span class="n">Chr</span><span class="p">(</span><span class="mi">13</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">WbN</span><span class="p">,</span> <span class="n">vbInformation</span><span class="p">,</span> <span class="s">&quot;提示&quot;</span>
<span class="k">End</span> <span class="k">Sub</span></code></pre></figure>

<p><strong>效果：</strong></p>
<p><img class="img-responsive center-block" alt="datasync" src="/assets/image/posts/excel2_0.png" width="594" height="405" /></p>
<p><img class="img-responsive center-block" alt="datasync" src="/assets/image/posts/excel2_1.png" width="594" height="405" /></p>
<p><img class="img-responsive center-block" alt="datasync" src="/assets/image/posts/excel2_2.png" width="594" height="405" /></p>


    </div>
    <div class="text-center">
        <div class="pagination">
            <ul>
                
                <li class="prev"><a href="/Blog/2015/04/16/cssanimation" title="CSS动画练习-大白和哆啦A梦"><i class="icon-fixed-width icon-arrow-left"></i> Previous</a></li>
                
                <li><a href="/archive">Archive</a></li>
                
                <li class="next"><a href="/Blog/2017/08/20/google-chromes-connection-error-egg-t-rex-runner" title="Google Chrome's Connection Error Egg : T-Rex Runner"><i class="icon-fixed-width icon-arrow-right"></i> Next</a></li>
                
            </ul>
        </div>
    </div>
    <div class="comments">
        


  <div id="gitmentComments"></div>
<link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">
<script src="https://imsun.github.io/gitment/dist/gitment.browser.js"></script>
<script>
var gitment = new Gitment({
  owner: 'liubing0427',
  repo: 'liubing0427.github.com',
  oauth: {
    client_id: 'd02658d99eca68237708',
    client_secret: '39fb7e21279923bb48a0dd91315330e8f7b12796',
  },
})
gitment.render('gitmentComments')
</script>





    </div>
</div>
<div class="col-md-4 sidebar">
    <div class="widget">
        
        <div class="sidebar-title"><i class="icon-fixed-width icon-tags"></i> Tags</div>
        <ul class="tag_box inline">
            
            


  
     
    	<li><a href="/tags#VBA-ref">VBA <span>1</span></a></li>
     
    	<li><a href="/tags#Excel-ref">Excel <span>1</span></a></li>
    
  



        </ul>
        
    </div>

    <div class="widget">
        <div class="sidebar-title"><i class="icon-fixed-width icon-file-text"></i> Related</div>
        <ul>
            
        </ul>
    </div>
    <!-- Baidu Button BEGIN -->
    


  <script type="text/javascript" id="bdshare_js" data="type=slide&amp;img=2&amp;pos=right&amp;uid=254497" ></script>
<script type="text/javascript" id="bdshell_js"></script>
<script type="text/javascript">
document.getElementById("bdshell_js").src = "http://bdimg.share.baidu.com/static/js/shell_v2.js?cdnversion=" + Math.ceil(new Date()/3600000);
</script>





    <!-- Baidu Button END -->
</div>


    </div>
</div>
<!-- /container -->
<footer class="footer ">
    <div class="container">
        <hr>
        <div class="row footer-bottom">
            <ul class="list-inline text-center">
                <li><p>&copy; Liu Bing 2017 </p></li>
            </ul>
        </div>
    </div>
</footer>
<script src="//cdn.bootcss.com/jquery/1.11.3/jquery.min.js"></script>
<script src="//cdn.bootcss.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>



  <script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3Fb8e145711258e179270df3c5f1b3c84b' type='text/javascript'%3E%3C/script%3E"));
</script>





</body>
</html>

